(this["webpackJsonptext-crdt-app"]=this["webpackJsonptext-crdt-app"]||[]).push([[0],{19:function(e){e.exports=JSON.parse('{"name":"text-crdt-app","version":"0.1.0","homepage":"http://jonfk.github.io/text-crdt-experiment-automerge-ts","dependencies":{"@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.4.0","@testing-library/user-event":"^7.2.1","@types/diff-match-patch":"^1.0.32","@types/jest":"^24.9.0","@types/node":"^12.12.25","@types/react":"^16.9.17","@types/react-dom":"^16.9.4","@types/react-helmet":"^5.0.15","@types/react-redux":"^7.1.6","automerge":"^0.12.1","cuid":"^2.1.8","diff-match-patch":"^1.0.4","immer":"^5.3.2","prettier":"^1.19.1","pretty-bytes":"^5.3.0","react":"^16.12.0","react-dom":"^16.12.0","react-helmet":"^5.2.1","react-redux":"^7.1.3","react-scripts":"3.3.0","redux":"^4.0.5","tslib":"^1.10.0","typescript":"^3.7.5"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","format":"prettier --write \\"src/**/*.{js,jsx,ts,tsx,json,css,scss,md}\\"","predeploy":"npm run build","deploy":"gh-pages -d build"},"eslintConfig":{"extends":"react-app"},"prettier":{"singleQuote":true},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"gh-pages":"^2.2.0"}}')},22:function(e,t,n){e.exports=n(38)},34:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);n(23);var a=n(0),r=n.n(a),c=n(8),o=n.n(c),l=n(16),i=(n(34),n(7));n(37);var s=n(1),d=n(13),u=n.n(d),p=n(3),m=n(20),f=n(21),g=n(18),y=n.n(g);function v(e,t){var n=new y.a.diff_match_patch,a=e.text.toString(),r=n.diff_main(a,t);n.diff_cleanupSemantic(r);var c=n.patch_make(a,r);console.log(c),console.log(n.patch_apply(c,a)[0]);var o=s.change(e,(function(e){c.forEach((function(t){var n=t.start1;null!==n&&t.diffs.forEach((function(t){var a=Object(f.a)(t,2),r=a[0],c=a[1];switch(r){case 1:e.text.insertAt.apply(void 0,[n].concat(Object(m.a)(c.split("")))),n+=c.length;break;case 0:n+=c.length;break;case-1:for(var o=0;o<c.length;o++)e.text.deleteAt(n)}}))}))}));return console.log("incoming text"),console.log(o.text.toString()),o}function b(e){return s.getChanges(e.lastSyncedDoc,e.doc)}function h(e,t){var n=s.applyChanges(e.doc,t);return Object(p.a)({},e,{doc:n,draft:n.text.toString()})}function E(e){return s.getChanges(e.lastSyncedDoc,e.doc).length>0}var x,S=function(e){var t,n=e.draft,a=e.doc,c=e.lastSyncedDoc;return r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement("span",null,"Text Size: ",u()(new Blob([a.text.toString()]).size)),r.a.createElement("br",null),r.a.createElement("span",null,"CRDT Size: ",u()(new Blob([s.save(a)]).size)),r.a.createElement("br",null),r.a.createElement("span",null,"UnSynced Changes?:"," ",E({draft:n,doc:a,lastSyncedDoc:c}).toString()),r.a.createElement("br",null),r.a.createElement("span",null,"Conflicts: ",JSON.stringify((t={draft:n,doc:a,lastSyncedDoc:c},s.getConflicts(t.doc,"text")))))},T={updateDraftText:function(e,t){return{type:"UPDATE_DRAFT_TEXT",editorId:e,payload:{text:t}}},saveTextBlock:function(e,t){return{type:"SAVE_TEXT",editorId:e,payload:{text:t}}},syncText:function(e,t){return{type:"SYNC_TEXT",from:e,to:t}}},j=Object(i.b)((function(e){return{editor:e.editors[0]}}),T),D=Object(i.b)((function(e){return{editor:e.editors[1]}}),T),O=function(e,t){return function(n){var a=n.editor,c=n.updateDraftText,o=n.saveTextBlock,l=n.syncText,i=E(a);return r.a.createElement("div",null,r.a.createElement("h2",null,"Editor ",e),r.a.createElement("textarea",{rows:10,cols:40,onChange:function(t){return c(e,t.target.value)},value:a.draft}),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){return o(e,a.draft)}},"Save"),r.a.createElement("button",{onClick:function(){return l(e,t)},disabled:!i},"Sync to other editor"),r.a.createElement(S,{draft:a.draft,doc:a.doc,lastSyncedDoc:a.lastSyncedDoc}))}},w=j(O(0,1)),_=D(O(1,0)),C=n(6),k=n(5),A=(x="editor-0",s.change(s.init(x),(function(e){e.text=new s.Text}))),I=s.load(s.save(A)),B={0:{doc:A,draft:A.text.toString(),lastSyncedDoc:A},1:{doc:I,draft:I.text.toString(),lastSyncedDoc:I}},X=Object(C.b)({editors:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"SAVE_TEXT":var a=t[n.editorId],r=v(a.doc,n.payload.text),c=Object(p.a)({},a,{doc:r});return Object(p.a)({},t,Object(k.a)({},n.editorId,c));case"UPDATE_DRAFT_TEXT":return Object(p.a)({},t,Object(k.a)({},n.editorId,Object(p.a)({},t[n.editorId],{draft:n.payload.text})));case"SYNC_TEXT":var o=t[n.from],l=t[n.to];console.log("syncing");var i=b(o);console.log(i);var s=h(l,i),d=Object(p.a)({},o,{lastSyncedDoc:o.doc});return Object(p.a)({},t,(e={},Object(k.a)(e,n.to,s),Object(k.a)(e,n.from,d),e));default:return t}}}),N=Object(C.c)(X),z=n(19),J=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(i.a,{store:N},r.a.createElement("div",null,"Automerge version : ",z.dependencies.automerge),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:{margin:"1em"}},r.a.createElement(w,null)),r.a.createElement("div",{style:{margin:"1em"}},r.a.createElement(_,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement((function(){return r.a.createElement("div",null,r.a.createElement(l.Helmet,null,r.a.createElement("meta",{charSet:"utf-8"}),r.a.createElement("title",null,"Text CRDT App")),r.a.createElement(J,null))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[22,1,2]]]);
//# sourceMappingURL=main.c121d146.chunk.js.map