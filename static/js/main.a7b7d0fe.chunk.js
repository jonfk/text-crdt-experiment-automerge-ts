(this["webpackJsonptext-crdt-experiment"]=this["webpackJsonptext-crdt-experiment"]||[]).push([[0],{14:function(e){e.exports=JSON.parse('{"name":"text-crdt-experiment","version":"0.1.0","homepage":"http://jonfk.github.io/text-crdt-experiment-automerge-ts","dependencies":{"@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.4.0","@testing-library/user-event":"^7.2.1","@types/diff-match-patch":"^1.0.32","@types/jest":"^24.9.0","@types/node":"^12.12.25","@types/react":"^16.9.17","@types/react-dom":"^16.9.4","@types/react-helmet":"^5.0.15","@types/react-redux":"^7.1.6","automerge":"^0.12.1","diff-match-patch":"^1.0.4","prettier":"^1.19.1","pretty-bytes":"^5.3.0","react":"^16.12.0","react-dom":"^16.12.0","react-helmet":"^5.2.1","react-redux":"^7.1.3","react-scripts":"3.3.0","redux":"^4.0.5","tslib":"^1.10.0","typescript":"^3.7.5"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","format":"prettier --write \\"src/**/*.{js,jsx,ts,tsx,json,css,scss,md}\\"","predeploy":"npm run build","deploy":"gh-pages -d build"},"eslintConfig":{"extends":"react-app"},"prettier":{"singleQuote":true},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"gh-pages":"^2.2.0"}}')},21:function(e,t,n){e.exports=n(37)},33:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);n(22);var a=n(0),r=n.n(a),c=n(8),i=n.n(c),o=n(17),l=(n(33),n(7));n(36);var s=n(1),d=n.n(s),u=n(13),m=n.n(u),p=n(2),f=n(20),g=n(19),v=n.n(g),b=function(e,t){var n=new v.a.diff_match_patch,a=n.diff_main(e.text.toString(),t);n.diff_cleanupSemantic(a);var r=n.patch_make(e.text.toString(),a);return d.a.change(e,(function(e){r.forEach((function(t){var n=t.start1;null!==n&&t.diffs.forEach((function(t){var a,r=Object(f.a)(t,2),c=r[0],i=r[1];switch(c){case 1:(null===(a=e.text.insertAt)||void 0===a?void 0:a.bind(e.text))(n,...i.split("")),n+=i.length;break;case 0:n+=i.length;break;case-1:for(var o=0;o<i.length;o++)e.text.deleteAt(n)}}))}))}))};function y(e){return d.a.getChanges(e.lastSyncedDoc,e.doc)}function E(e,t){var n=d.a.applyChanges(e.doc,t);return Object(p.a)({},e,{doc:n,draft:n.text.toString()})}function x(e,t){return d.a.getChanges(e,t).length>0}var h,T,S,j=function(e){var t=e.doc,n=e.lastSyncedDoc,a=e.saveTimingMs,c=e.syncTimingMs;return r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement("span",null,"Text Size: ",m()(new Blob([t.text.toString()]).size)),r.a.createElement("br",null),r.a.createElement("span",null,"CRDT Size: ",m()(new Blob([d.a.save(t)]).size)),r.a.createElement("br",null),r.a.createElement("span",null,"UnSynced Changes?: ",x(n,t).toString()),r.a.createElement("br",null),r.a.createElement("span",null,"Time to Save: ",a," ms"),r.a.createElement("br",null),r.a.createElement("span",null,"Time to Sync: ",c," ms"),r.a.createElement("br",null),r.a.createElement("span",null,"Conflicts: ",JSON.stringify(function(e){return d.a.getConflicts(e,"text")}(t))))},w={updateDraftText:function(e,t){return{type:"UPDATE_DRAFT_TEXT",editorId:e,payload:{text:t}}},saveTextBlock:function(e,t){return{type:"SAVE_TEXT",editorId:e,payload:{text:t}}},syncText:function(e,t){return{type:"SYNC_TEXT",from:e,to:t}}},O=Object(l.b)((function(e){return{editor:e.editors[0]}}),w),D=Object(l.b)((function(e){return{editor:e.editors[1]}}),w),C=function(e,t){return function(n){var a=n.editor,c=n.updateDraftText,i=n.saveTextBlock,o=n.syncText,l=x(a.lastSyncedDoc,a.doc);return r.a.createElement("div",null,r.a.createElement("h2",null,"Editor ",e),r.a.createElement("textarea",{rows:10,cols:40,onChange:function(t){return c(e,t.target.value)},value:a.draft}),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){return i(e,a.draft)},disabled:a.draft===a.doc.text.toString()},"Save"),r.a.createElement("button",{onClick:function(){return o(e,t)},disabled:!l},"Sync to other editor"),r.a.createElement(j,a))}},_=O(C(0,1)),k=D(C(1,0)),A=n(6),M=n(5),I=(h="editor-0",T="",d.a.change(d.a.init(h),(function(e){var t;return e.text=new d.a.Text(T),(null===(t=e.text.insertAt)||void 0===t?void 0:t.bind(e.text))(0,...T.split(""))}))),B=(S=I,d.a.load(d.a.save(S))),X={0:{doc:I,draft:I.text.toString(),lastSyncedDoc:I,saveTimingMs:0,syncTimingMs:0},1:{doc:B,draft:B.text.toString(),lastSyncedDoc:B,saveTimingMs:0,syncTimingMs:0}},N=Object(A.b)({editors:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"SAVE_TEXT":var a=performance.now(),r=t[n.editorId],c=b(r.doc,n.payload.text),i=performance.now(),o=Object(p.a)({},r,{doc:c,saveTimingMs:i-a});return Object(p.a)({},t,Object(M.a)({},n.editorId,o));case"UPDATE_DRAFT_TEXT":return Object(p.a)({},t,Object(M.a)({},n.editorId,Object(p.a)({},t[n.editorId],{draft:n.payload.text})));case"SYNC_TEXT":var l=performance.now(),s=t[n.from],d=t[n.to],u=y(s),m=E(d,u),f=performance.now(),g=f-l;x(d.lastSyncedDoc,d.doc)||(m.lastSyncedDoc=m.doc);var v=Object(p.a)({},m,{syncTimingMs:g}),h=Object(p.a)({},s,{lastSyncedDoc:s.doc,syncTimingMs:g});return Object(p.a)({},t,(e={},Object(M.a)(e,n.to,v),Object(M.a)(e,n.from,h),e));default:return t}}}),z=Object(A.c)(N),J=n(14),R=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(l.a,{store:z},r.a.createElement("h1",null,J.name),r.a.createElement("div",null,"Automerge version : ",J.dependencies.automerge),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:{margin:"1em"}},r.a.createElement(_,null)),r.a.createElement("div",{style:{margin:"1em"}},r.a.createElement(k,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement((function(){return r.a.createElement("div",null,r.a.createElement(o.Helmet,null,r.a.createElement("meta",{charSet:"utf-8"}),r.a.createElement("title",null,"Text CRDT App")),r.a.createElement(R,null))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[21,1,2]]]);
//# sourceMappingURL=main.a7b7d0fe.chunk.js.map