(this["webpackJsonptext-crdt-app"]=this["webpackJsonptext-crdt-app"]||[]).push([[0],{19:function(e){e.exports=JSON.parse('{"name":"text-crdt-app","version":"0.1.0","homepage":"http://jonfk.github.io/text-crdt-experiment-automerge-ts","dependencies":{"@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.4.0","@testing-library/user-event":"^7.2.1","@types/diff-match-patch":"^1.0.32","@types/jest":"^24.9.0","@types/node":"^12.12.25","@types/react":"^16.9.17","@types/react-dom":"^16.9.4","@types/react-helmet":"^5.0.15","@types/react-redux":"^7.1.6","automerge":"^0.12.1","diff-match-patch":"^1.0.4","prettier":"^1.19.1","pretty-bytes":"^5.3.0","react":"^16.12.0","react-dom":"^16.12.0","react-helmet":"^5.2.1","react-redux":"^7.1.3","react-scripts":"3.3.0","redux":"^4.0.5","tslib":"^1.10.0","typescript":"^3.7.5"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","format":"prettier --write \\"src/**/*.{js,jsx,ts,tsx,json,css,scss,md}\\"","predeploy":"npm run build","deploy":"gh-pages -d build"},"eslintConfig":{"extends":"react-app"},"prettier":{"singleQuote":true},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"gh-pages":"^2.2.0"}}')},21:function(e,t,n){e.exports=n(37)},33:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);n(22);var a=n(0),r=n.n(a),c=n(8),o=n.n(c),l=n(16),i=(n(33),n(7));n(36);var s=n(1),d=n.n(s),u=n(13),p=n.n(u),f=n(3),m=n(20),g=n(18),v=n.n(g),y=function(e,t){var n=new v.a.diff_match_patch,a=n.diff_main(e.text.toString(),t);n.diff_cleanupSemantic(a);var r=n.patch_make(e.text.toString(),a);console.log(r),console.log(n.patch_apply(r,e.text.toString())[0]);var c=d.a.change(e,(function(e){r.forEach((function(t){var n=t.start1;null!==n&&t.diffs.forEach((function(t){var a,r=Object(m.a)(t,2),c=r[0],o=r[1];switch(c){case 1:(null===(a=e.text.insertAt)||void 0===a?void 0:a.bind(e.text))(n,...o.split("")),n+=o.length;break;case 0:n+=o.length;break;case-1:for(var l=0;l<o.length;l++)e.text.deleteAt(n)}}))}))}));return console.log("incoming text"),console.log(c.text.toString()),c};function b(e){return d.a.getChanges(e.lastSyncedDoc,e.doc)}function h(e,t){var n=d.a.applyChanges(e.doc,t);return Object(f.a)({},e,{doc:n,draft:n.text.toString()})}function x(e){return d.a.getChanges(e.lastSyncedDoc,e.doc).length>0}var E,S,T=function(e){var t,n=e.draft,a=e.doc,c=e.lastSyncedDoc;return r.a.createElement("div",null,r.a.createElement("br",null),r.a.createElement("span",null,"Text Size: ",p()(new Blob([a.text.toString()]).size)),r.a.createElement("br",null),r.a.createElement("span",null,"CRDT Size: ",p()(new Blob([d.a.save(a)]).size)),r.a.createElement("br",null),r.a.createElement("span",null,"UnSynced Changes?:"," ",x({draft:n,doc:a,lastSyncedDoc:c}).toString()),r.a.createElement("br",null),r.a.createElement("span",null,"Conflicts: ",JSON.stringify((t={draft:n,doc:a,lastSyncedDoc:c},d.a.getConflicts(t.doc,"text")))))},j={updateDraftText:function(e,t){return{type:"UPDATE_DRAFT_TEXT",editorId:e,payload:{text:t}}},saveTextBlock:function(e,t){return{type:"SAVE_TEXT",editorId:e,payload:{text:t}}},syncText:function(e,t){return{type:"SYNC_TEXT",from:e,to:t}}},D=Object(i.b)((function(e){return{editor:e.editors[0]}}),j),O=Object(i.b)((function(e){return{editor:e.editors[1]}}),j),w=function(e,t){return function(n){var a=n.editor,c=n.updateDraftText,o=n.saveTextBlock,l=n.syncText,i=x(a);return r.a.createElement("div",null,r.a.createElement("h2",null,"Editor ",e),r.a.createElement("textarea",{rows:10,cols:40,onChange:function(t){return c(e,t.target.value)},value:a.draft}),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){return o(e,a.draft)}},"Save"),r.a.createElement("button",{onClick:function(){return l(e,t)},disabled:!i},"Sync to other editor"),r.a.createElement(T,{draft:a.draft,doc:a.doc,lastSyncedDoc:a.lastSyncedDoc}))}},_=D(w(0,1)),C=O(w(1,0)),k=n(6),A=n(5),I=(E="editor-0",S="",d.a.change(d.a.init(E),(function(e){var t;return e.text=new d.a.Text(S),(null===(t=e.text.insertAt)||void 0===t?void 0:t.bind(e.text))(0,...S.split(""))}))),B=d.a.load(d.a.save(I)),X={0:{doc:I,draft:I.text.toString(),lastSyncedDoc:I},1:{doc:B,draft:B.text.toString(),lastSyncedDoc:B}},N=Object(k.b)({editors:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"SAVE_TEXT":var a=t[n.editorId],r=y(a.doc,n.payload.text),c=Object(f.a)({},a,{doc:r});return Object(f.a)({},t,Object(A.a)({},n.editorId,c));case"UPDATE_DRAFT_TEXT":return Object(f.a)({},t,Object(A.a)({},n.editorId,Object(f.a)({},t[n.editorId],{draft:n.payload.text})));case"SYNC_TEXT":var o=t[n.from],l=t[n.to];console.log("syncing");var i=b(o);console.log(i);var s=h(l,i),d=Object(f.a)({},o,{lastSyncedDoc:o.doc});return Object(f.a)({},t,(e={},Object(A.a)(e,n.to,s),Object(A.a)(e,n.from,d),e));default:return t}}}),z=Object(k.c)(N),J=n(19),R=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(i.a,{store:z},r.a.createElement("div",null,"Automerge version : ",J.dependencies.automerge),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:{margin:"1em"}},r.a.createElement(_,null)),r.a.createElement("div",{style:{margin:"1em"}},r.a.createElement(C,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement((function(){return r.a.createElement("div",null,r.a.createElement(l.Helmet,null,r.a.createElement("meta",{charSet:"utf-8"}),r.a.createElement("title",null,"Text CRDT App")),r.a.createElement(R,null))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[21,1,2]]]);
//# sourceMappingURL=main.b22bdf61.chunk.js.map